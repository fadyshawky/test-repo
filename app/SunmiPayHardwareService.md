# SunmiPayHardwareService

Update Time:2024-10-24 06:41:20

# **1.** Overview

SunmiPaySDK is a financial SDK based on SP（secure processor）. SDK provide interfaces to client App by Android AIDL. SDK contains modules: Basic info module, Card module, EMV module, PinPad module, Security module, ETC module, Tax module, etc. Client APP could access Sunmi financial service interfaces conveniently after integrating this SDK.

## 1.1 Function introduction

Module functions of SunmiPaySDK:

- **Basic info module**: provide system info related interfaces, such as set/get system param, system buzzer, LED light control, etc.
- **Card module**: provide card operation related interfaces, such as check card, APDU exchange, card off, etc. Meanwhile, also provide interfaces of mifare card, AT24C serials card, SLE serials card, etc.
- **EMV module**: provide transaction related interfaces, such as save/delete AIDs and Capks, save terminal params, init EMV procedure, start EMV process, set/get TLV data, etc.
- **PinPad module**: provide PinPad related interfaces, such as init PinPad, cancel input PIN, set PinPad text, set/get PinPad mode, etc.
- **Security module:** provide key related interfaces, such as save MKSK/Dukpt/SM2/RSA keys, use saved keys to encrypt/decrypt data, calculate Mac, etc.
- **ETC module**：provide ETC( Electronic Toll Collection ) related interfaces, such as search OBU, ETC trade, etc. This module only used in china.
- **Tax module**: provide fiscal data exchange interfaces.

## **1.2** SDK file illustration

**Name**

**Function**

**Backup**

PayLib-release-x.x.x.aar

aar packet which compiled from SDK AIDL files

Client APP should integrate this file

PayLib-release-x.x.x-sources.jar

Provide source code of classes in PayLib-release-x.x.x.aar

Option file, not necessary for client APP

SUNMI PAY SDK V2  开发文档\_x.x.x.docx

Chinese version SDK interfaces document

SUNMI PAY SDK V2 Development Document_x.x.x.docx

English version SDK interfaces document

SunmiPaySdkTestDemo.rar

Source code of SDKTestDemo. Provide demo of access all kinds of SDK interfaces

SunmiSDKTestDemo_x.x.x_debug.apk

APK file, generated by SDKTestDemo source code

# 2.Environment info

**System environment**

**platform**

**Compile IDE**

Android 6.0+

arm64， arm32

Android studio

# **3.** SDK full package

Note： SDK full package contains PayLib-release-x.x.x.aar file, SDK interfaces documents file, SDKTestDemo source code file and SDKTestDemo apk file.

## 3.1 import SDK package to project

- Local dependency

  1.  In Android Studio project, put PayLib-release-x.x.x.aar into libs directory.
  2.  **bashccppcsharpcssgojavajavascriptjsonkotlinlessmakefilemarkdownobjectivecphpplaintextpythonrustscssshellsqlswifttypescriptxmlyaml**复制代码 repositories { flatDir { dirs 'libs' }}dependencies { ...... implementation(name: 'PayLib-release-x.x.x', ext: 'aar')}

- Remote dependency

  1.  **bashccppcsharpcssgojavajavascriptjsonkotlinlessmakefilemarkdownobjectivecphpplaintextpythonrustscssshellsqlswifttypescriptxmlyaml**复制代码 dependencies { implementation 'com.sunmi:PayLib-release:2.0.07'}
  2.  **bashccppcsharpcssgojavajavascriptjsonkotlinlessmakefilemarkdownobjectivecphpplaintextpythonrustscssshellsqlswifttypescriptxmlyaml**复制代码 repositories { mavenCentral()}

## 3.2 initialize and connect to SDK Service

Refer to the following code to connect to Sunmi Financial service:

**bashccppcsharpcssgojavajavascriptjsonkotlinlessmakefilemarkdownobjectivecphpplaintextpythonrustscssshellsqlswifttypescriptxmlyaml**复制代码

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML`  /** bind PaySDK service */  public void bindPaySDKService() {      final SunmiPayKernel payKernel = SunmiPayKernel.getInstance();      payKernel.initPaySDK(this, new SunmiPayKernel.ConnectCallback() {          @Override          public void onConnectPaySDK() {              LogUtil.e(Constant.TAG, "onConnectPaySDK...");              emvOptV2 = payKernel.mEMVOptV2;              basicOptV2 = payKernel.mBasicOptV2;              pinPadOptV2 = payKernel.mPinPadOptV2;              readCardOptV2 = payKernel.mReadCardOptV2;              securityOptV2 = payKernel.mSecurityOptV2;              taxOptV2 = payKernel.mTaxOptV2;              etcOptV2 = payKernel.mETCOptV2;              printerOptV2 = payKernel.mPrinterOptV2;              connectPaySDK = true;          }          @Override          public void onDisconnectPaySDK() {              LogUtil.e(Constant.TAG, "onDisconnectPaySDK...");              connectPaySDK = false;              emvOptV2 = null;              basicOptV2 = null;              pinPadOptV2 = null;              readCardOptV2 = null;              securityOptV2 = null;              taxOptV2 = null;              etcOptV2 = null;              printerOptV2 = null;              Utility.showToast(R.string.connect_fail);          }      });  }  `

## 3.3 Implement EMV L2 split library in project

Although SunmiPayHardwareService(SPHS) has already provided the EMV module for client APP, for some device types, EMV library can be also implemented by client APP individually. When integrating, the following steps must be followed:

1.  Decompress SDK package and the EMVSplit_xxx.rar, integrate the sunmiemvl2split-xxx.jar, EMV so files in armeabi-v7a and PayLib-release-2.0.17.aar(or higher version) into the client APP project’s libs directory.
2.  **bashccppcsharpcssgojavajavascriptjsonkotlinlessmakefilemarkdownobjectivecphpplaintextpythonrustscssshellsqlswifttypescriptxmlyaml**复制代码
3.  **bashccppcsharpcssgojavajavascriptjsonkotlinlessmakefilemarkdownobjectivecphpplaintextpythonrustscssshellsqlswifttypescriptxmlyaml**复制代码 sourceSets { main { jniLibs.srcDirs = \['libs'\] }}implementation fileTree(dir: 'libs', include: \['\*.jar'\])
4.  **bashccppcsharpcssgojavajavascriptjsonkotlinlessmakefilemarkdownobjectivecphpplaintextpythonrustscssshellsqlswifttypescriptxmlyaml**复制代码 final SunmiPayKernel payKernel = SunmiPayKernel.getInstance();payKernel.setEmvL2Split(true);...**Note: If EMV l2 split library not enabled, the default EMV function in SDK will be used.**
5.  **The EMV l2 split library only applicable to devices with v5.x.x SPHS, for devices with 3.x.x SPHS, it’s not applicable.**

# 4\. Notes：

1.On Android 11.0+ system, client App should add the following permission in AndroidManifest.xml file before binding SunmiPayHardwareService, or an error toast “bind PayHardwareService failed: service not found” will show:

**bashccppcsharpcssgojavajavascriptjsonkotlinlessmakefilemarkdownobjectivecphpplaintextpythonrustscssshellsqlswifttypescriptxmlyaml**复制代码

Plain textANTLR4BashCC#CSSCoffeeScriptCMakeDartDjangoDockerEJSErlangGitGoGraphQLGroovyHTMLJavaJavaScriptJSONJSXKotlinLaTeXLessLuaMakefileMarkdownMATLABMarkupObjective-CPerlPHPPowerShell.propertiesProtocol BuffersPythonRRubySass (Sass)Sass (Scss)SchemeSQLShellSwiftSVGTSXTypeScriptWebAssemblyYAMLXML `android:name="android.permission.QUERY_ALL_PACKAGES"    tools:ignore="QueryAllPackagesPermission" />`
